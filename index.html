<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MBTI í”„ë¡œëª¨ì…˜ 2026 â€” JíŒ€ vs PíŒ€</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.css">
<style>
:root{
  --bg:#09090f;--bg2:#0f1018;--bg3:#161820;
  --j:#5b9cf6;--j2:#2563eb;--jg:rgba(91,156,246,.28);--js:rgba(91,156,246,.08);
  --p:#fb923c;--p2:#ea580c;--pg:rgba(251,146,60,.28);--ps:rgba(251,146,60,.08);
  --win:#10b981;--lose:#f43f5e;--gold:#fbbf24;
  --text:#e2e8f0;--sub:#94a3b8;--muted:#64748b;
  --bd:rgba(255,255,255,.07);--bd2:rgba(255,255,255,.12);
}
*{margin:0;padding:0;box-sizing:border-box;}
body{background:var(--bg);color:var(--text);font-family:'Pretendard',-apple-system,sans-serif;min-height:100vh;font-size:14px;line-height:1.5;}
body::before{content:'';position:fixed;inset:0;pointer-events:none;z-index:0;
  background-image:linear-gradient(rgba(91,156,246,.022) 1px,transparent 1px),linear-gradient(90deg,rgba(91,156,246,.022) 1px,transparent 1px);
  background-size:52px 52px;}
.wrap{position:relative;z-index:1;max-width:1180px;margin:0 auto;padding:32px 20px 90px;}
header{text-align:center;padding:40px 0 30px;animation:fadeDown .65s ease both;}
.promo-chip{display:inline-block;font-size:11px;font-weight:600;letter-spacing:3px;color:var(--muted);border:1px solid var(--bd2);padding:5px 18px;border-radius:99px;margin-bottom:16px;}
h1{font-size:clamp(28px,5vw,50px);font-weight:900;letter-spacing:-1px;line-height:1.05;background:linear-gradient(115deg,var(--j) 0%,#a78bfa 48%,var(--p) 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;}
.subtitle{margin-top:10px;color:var(--muted);font-size:13px;}
#loading{text-align:center;padding:100px 20px;color:var(--muted);}
.spin{display:inline-block;font-size:36px;animation:spin 1s linear infinite;margin-bottom:16px;}
@keyframes spin{to{transform:rotate(360deg)}}
.loading-text{font-size:15px;font-weight:600;color:var(--sub);}
.loading-sub{font-size:12px;margin-top:6px;}
#error-msg{display:none;text-align:center;padding:60px 20px;}
/* â”€â”€ score-hero ìƒˆ ë ˆì´ì•„ì›ƒ â”€â”€ */
.score-hero{background:var(--bg2);border:1px solid var(--bd);border-radius:18px;overflow:hidden;margin-bottom:12px;animation:fadeUp .55s .1s ease both;}
.score-hero-top{display:grid;grid-template-columns:1fr auto 1fr;}
/* JíŒ€: [ë©”íƒ€ ìš°ì •ë ¬] [ìŠ¹ìˆ˜ ì¤‘ì•™] | PíŒ€: [ìŠ¹ìˆ˜ ì¤‘ì•™] [ë©”íƒ€ ì¢Œì •ë ¬] */
.score-side{padding:22px 28px;display:grid;grid-template-columns:1fr auto 1fr;align-items:center;gap:0;position:relative;}
.score-side.j{background:linear-gradient(140deg,rgba(91,156,246,.13) 0%,transparent 70%);}
.score-side.p{background:linear-gradient(220deg,rgba(251,146,60,.13) 0%,transparent 70%);}
/* JíŒ€: ë©”íƒ€(col1 ìš°ì •ë ¬) â†’ ìŠ¹ìˆ˜(col2 center) â†’ ë¹ˆì¹¸(col3) */
.score-side.j .s-meta{grid-column:1;display:flex;flex-direction:column;gap:6px;align-items:flex-end;text-align:right;}
.score-side.j .s-wins-wrap{grid-column:2;margin-left:18px;}
/* PíŒ€: ë¹ˆì¹¸(col1) â†’ ìŠ¹ìˆ˜(col2 center) â†’ ë©”íƒ€(col3 ì¢Œì •ë ¬) */
.score-side.p .s-wins-wrap{grid-column:2;margin-right:18px;}
.score-side.p .s-meta{grid-column:3;display:flex;flex-direction:column;gap:6px;align-items:flex-start;text-align:left;}
/* ìŠ¹ìˆ˜ wrap */
.s-wins-wrap{display:flex;flex-direction:column;align-items:center;justify-content:center;}
.s-wins{font-size:64px;font-weight:900;line-height:1;letter-spacing:-2px;}
.score-side.j .s-wins{color:var(--j);text-shadow:0 0 32px var(--jg);}
.score-side.p .s-wins{color:var(--p);text-shadow:0 0 32px var(--pg);}
.s-unit{font-size:16px;font-weight:700;opacity:.65;margin-top:3px;}
.score-side.j .s-unit{color:var(--j);}
.score-side.p .s-unit{color:var(--p);}
.s-meta{display:flex;flex-direction:column;gap:6px;}
.s-name{font-size:20px;font-weight:900;letter-spacing:-.5px;}
.score-side.j .s-name{color:var(--j);}
.score-side.p .s-name{color:var(--p);}
/* s-need: JíŒ€ì€ íŒŒë€ìƒ‰, PíŒ€ì€ ì£¼í™©ìƒ‰ */
.s-need{font-size:11px;font-weight:700;border-radius:99px;padding:2px 10px;display:inline-block;}
.score-side.j .s-need{color:var(--j);background:rgba(91,156,246,.12);border:1px solid rgba(91,156,246,.3);}
.score-side.p .s-need{color:var(--p);background:rgba(251,146,60,.12);border:1px solid rgba(251,146,60,.3);}
.s-sub{display:none;}
.s-lbl{display:none;}
.score-center{display:flex;flex-direction:column;align-items:center;justify-content:center;background:var(--bg3);gap:5px;padding:12px 18px;white-space:nowrap;}
.vs-txt{font-size:13px;font-weight:900;color:rgba(255,255,255,.12);letter-spacing:3px;}
.target-chip{font-size:9px;font-weight:700;letter-spacing:1px;color:var(--gold);background:rgba(251,191,36,.1);border:1px solid rgba(251,191,36,.3);border-radius:99px;padding:2px 10px;}
.days-info{font-size:10px;color:var(--muted);text-align:center;line-height:1.7;font-weight:500;}
/* ìµœê·¼ 5ê²½ê¸° ë°” */
.recent5-bar{display:flex;align-items:center;gap:0;border-top:1px solid var(--bd);padding:10px 22px;background:rgba(255,255,255,.015);}
.recent5-label{font-size:10px;font-weight:700;color:var(--muted);letter-spacing:.5px;margin-right:12px;white-space:nowrap;}
.recent5-cards{display:flex;gap:6px;flex:1;}
.r5-card{flex:1;min-width:0;border-radius:8px;padding:6px 4px;text-align:center;border:1px solid var(--bd);}
.r5-card.r5-j{background:rgba(91,156,246,.12);border-color:rgba(91,156,246,.35);}
.r5-card.r5-p{background:rgba(251,146,60,.12);border-color:rgba(251,146,60,.35);}
.r5-card.r5-empty{opacity:.3;}
.r5-date{font-size:9px;font-weight:600;color:var(--muted);margin-bottom:3px;}
.r5-winner{font-size:11px;font-weight:800;}
.r5-card.r5-j .r5-winner{color:var(--j);}
.r5-card.r5-p .r5-winner{color:var(--p);}
.r5-score{font-size:9px;color:var(--muted);margin-top:1px;}
/* ìŠ¤íŠ¸ë¦­ ë°°ë„ˆ */
.banners-row{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:12px;}
@media(max-width:640px){.banners-row{grid-template-columns:1fr;}}
.streak-banner{background:var(--bg2);border:1px solid var(--bd);border-radius:14px;padding:12px 18px;display:flex;align-items:center;gap:14px;position:relative;overflow:hidden;animation:fadeUp .55s .12s ease both;}
.streak-banner::before{content:'';position:absolute;inset:0;pointer-events:none;}
.streak-banner.j-streak::before{background:linear-gradient(90deg,rgba(91,156,246,.09),transparent 60%);}
.streak-banner.p-streak::before{background:linear-gradient(90deg,rgba(251,146,60,.09),transparent 60%);}
.streak-banner.mvp-banner::before{background:linear-gradient(90deg,rgba(251,191,36,.08),transparent 60%);}
.streak-icon{font-size:24px;flex-shrink:0;animation:pulseIcon 1.6s ease-in-out infinite;}
@keyframes pulseIcon{0%,100%{transform:scale(1)}50%{transform:scale(1.15)}}
.streak-body{flex:1;min-width:0;}
.streak-main{font-size:13px;font-weight:800;line-height:1.3;}
.streak-main.j{color:var(--j);}
.streak-main.p{color:var(--p);}
.streak-main.gold{color:var(--gold);}
.streak-main em{font-style:normal;color:var(--gold);}
.streak-sub{font-size:11px;color:var(--muted);margin-top:2px;}
.streak-dots{display:flex;gap:5px;flex-shrink:0;}
.s-dot{width:22px;height:22px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:9px;font-weight:800;}
.s-dot.j{background:rgba(91,156,246,.2);border:1.5px solid var(--j);color:var(--j);}
.s-dot.p{background:rgba(251,146,60,.2);border:1.5px solid var(--p);color:var(--p);}
.s-dot.fire{background:rgba(251,191,36,.12);border:1.5px solid var(--gold);color:var(--gold);animation:firePulse .9s ease-in-out infinite alternate;}
@keyframes firePulse{from{box-shadow:0 0 3px rgba(251,191,36,.3)}to{box-shadow:0 0 10px rgba(251,191,36,.7)}}
/* MVP ë°°ì§€ */
.mvp-badge{display:inline-flex;align-items:center;gap:4px;font-size:9px;font-weight:700;color:var(--gold);background:rgba(251,191,36,.12);border:1px solid rgba(251,191,36,.3);border-radius:99px;padding:2px 8px;margin-top:4px;}
/* day-card MVP ê°•ì¡° */
.day-mvp{font-size:10px;font-weight:700;color:var(--gold);margin-top:4px;display:flex;align-items:center;justify-content:center;gap:3px;}
.day-mvp-star{font-size:10px;}
.race-wrap{background:var(--bg2);border:1px solid var(--bd);border-radius:18px;padding:22px 26px;margin-bottom:20px;animation:fadeUp .55s .17s ease both;}
.section-hd{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;}
.section-title{font-size:15px;font-weight:800;letter-spacing:-.3px;display:flex;align-items:center;gap:9px;}
.live-dot{width:8px;height:8px;border-radius:50%;background:var(--win);box-shadow:0 0 8px var(--win);animation:blink 1.4s ease infinite;}
.section-meta{font-size:11px;font-weight:600;color:var(--muted);}
.chart-legend{display:flex;gap:16px;align-items:center;}
.legend-item{display:flex;align-items:center;gap:6px;font-size:11px;font-weight:600;color:var(--muted);}
.legend-dot{width:10px;height:10px;border-radius:50%;}
.legend-dot.j{background:var(--j);}
.legend-dot.p{background:var(--p);}
.legend-line-gold{width:14px;height:0;border-top:2px dashed var(--gold);}
.chart-canvas-wrap{position:relative;width:100%;height:200px;margin-bottom:12px;}
#raceChart{position:absolute;inset:0;width:100%!important;height:100%!important;}
/* mini race bar */
.mini-race-outer{position:relative;height:36px;background:var(--bg3);border-radius:10px;overflow:hidden;border:1px solid var(--bd);margin-bottom:6px;}
.mini-race-outer::after{content:'ğŸ';position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);font-size:14px;opacity:.5;pointer-events:none;}
.mini-finish{position:absolute;left:50%;top:0;bottom:0;width:1px;background:linear-gradient(180deg,transparent,var(--gold),transparent);opacity:.7;transform:translateX(-50%);}
.mini-j-track{position:absolute;left:0;top:0;bottom:0;right:50%;overflow:hidden;}
.mini-j-fill{position:absolute;left:0;top:0;bottom:0;background:linear-gradient(90deg,var(--j2),var(--j));border-radius:0 4px 4px 0;transition:width 1.4s cubic-bezier(.34,1.2,.64,1);}
.mini-j-car{position:absolute;top:50%;transform:translateY(-50%);font-size:16px;transition:left 1.4s cubic-bezier(.34,1.2,.64,1);filter:drop-shadow(0 0 4px rgba(91,156,246,.8));animation:carBob .6s ease-in-out infinite;z-index:10;}
.mini-p-track{position:absolute;right:0;top:0;bottom:0;left:50%;overflow:hidden;}
.mini-p-fill{position:absolute;right:0;top:0;bottom:0;background:linear-gradient(270deg,var(--p2),var(--p));border-radius:4px 0 0 4px;transition:width 1.4s cubic-bezier(.34,1.2,.64,1);}
.mini-p-car{position:absolute;top:50%;font-size:16px;transition:right 1.4s cubic-bezier(.34,1.2,.64,1);filter:drop-shadow(0 0 4px rgba(251,146,60,.8));animation:carBobR .7s ease-in-out infinite;animation-delay:.15s;z-index:10;}
.mini-race-score-row{display:flex;justify-content:space-between;align-items:center;font-size:11px;font-weight:700;}
.rs-j{color:var(--j);}
.rs-p{color:var(--p);}
.rs-mid{color:var(--muted);font-size:10px;}
@keyframes carBob{0%,100%{transform:translateY(-50%)}50%{transform:translateY(calc(-50% - 2px))}}
@keyframes carBobR{0%,100%{transform:translateY(-50%) scaleX(-1)}50%{transform:translateY(calc(-50% - 2px)) scaleX(-1)}}
/* ì˜ˆì¸¡ ì¹´ë“œ */
.forecast-wrap{background:var(--bg2);border:1px solid var(--bd);border-radius:18px;padding:20px 24px;margin-bottom:20px;animation:fadeUp .55s .2s ease both;}
.forecast-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:12px;margin-top:14px;}
.fc-card{background:var(--bg3);border:1px solid var(--bd);border-radius:12px;padding:14px 16px;}
.fc-label{font-size:9px;font-weight:700;letter-spacing:1.5px;color:var(--muted);text-transform:uppercase;margin-bottom:8px;}
.fc-value{font-size:20px;font-weight:900;letter-spacing:-.5px;}
.fc-value.j{color:var(--j);}
.fc-value.p{color:var(--p);}
.fc-value.gold{color:var(--gold);}
.fc-value.win{color:var(--win);}
.fc-sub{font-size:10px;color:var(--muted);margin-top:3px;line-height:1.5;}
.fc-bar{height:3px;background:rgba(255,255,255,.06);border-radius:99px;margin-top:10px;overflow:hidden;}
.fc-bar-fill{height:100%;border-radius:99px;}
.fc-bar-fill.j{background:linear-gradient(90deg,var(--j2),var(--j));}
.fc-bar-fill.p{background:linear-gradient(90deg,var(--p2),var(--p));}
.forecast-note{font-size:10px;color:var(--muted);margin-top:10px;line-height:1.7;padding:8px 12px;background:rgba(255,255,255,.025);border-radius:8px;border-left:2px solid rgba(91,156,246,.3);}
@media(max-width:720px){.forecast-grid{grid-template-columns:repeat(2,1fr);}}
.weekly-wrap{background:var(--bg2);border:1px solid var(--bd);border-radius:18px;padding:22px 24px;margin-bottom:20px;animation:fadeUp .55s .23s ease both;}
.week-block{margin-bottom:18px;}
.week-block:last-child{margin-bottom:0;}
.week-label{font-size:11px;font-weight:700;letter-spacing:1px;color:var(--muted);text-transform:uppercase;margin-bottom:10px;display:flex;align-items:center;gap:8px;flex-wrap:wrap;}
.week-wins-summary{font-size:10px;font-weight:700;padding:2px 9px;border-radius:99px;}
.wws-j{background:var(--js);color:var(--j);border:1px solid rgba(91,156,246,.3);}
.wws-p{background:var(--ps);color:var(--p);border:1px solid rgba(251,146,60,.3);}
.wws-tie{background:rgba(255,255,255,.05);color:var(--muted);}
.week-days{display:grid;gap:8px;}
.day-card{background:var(--bg3);border-radius:12px;padding:12px 10px 10px;border:1px solid var(--bd);text-align:center;transition:transform .18s,box-shadow .18s;position:relative;overflow:hidden;cursor:default;}
.day-card:hover{transform:translateY(-3px);box-shadow:0 8px 24px rgba(0,0,0,.4);}
.day-card:hover .day-detail{opacity:1;}
.day-detail{position:absolute;inset:0;border-radius:12px;background:rgba(9,9,15,.88);backdrop-filter:blur(2px);display:flex;flex-direction:column;align-items:center;justify-content:center;gap:3px;opacity:0;transition:opacity .2s;padding:6px;pointer-events:none;}
.dd-title{font-size:8px;font-weight:700;letter-spacing:1.5px;color:var(--muted);margin-bottom:3px;text-transform:uppercase;}
.dd-score-row{display:flex;align-items:center;gap:5px;font-size:11px;}
.dd-team{font-size:9px;font-weight:800;width:14px;}
.dd-val{font-size:12px;font-weight:900;}
.dd-diff{font-size:13px;font-weight:900;margin-top:3px;}
.day-card.j-win{border-color:rgba(91,156,246,.35);background:linear-gradient(160deg,rgba(91,156,246,.08),var(--bg3));}
.day-card.p-win{border-color:rgba(251,146,60,.35);background:linear-gradient(160deg,rgba(251,146,60,.08),var(--bg3));}
.day-card.upcoming{opacity:.38;}
.day-card.holiday{opacity:.38;}
.day-card.today-card{border-color:var(--gold)!important;opacity:1;}
.day-date{font-size:11px;font-weight:700;color:var(--muted);margin-bottom:8px;}
.day-scores{display:flex;justify-content:center;align-items:center;gap:7px;margin-bottom:7px;}
.day-sc{font-size:14px;font-weight:800;}
.day-sc.j{color:var(--j);}
.day-sc.p{color:var(--p);}
.day-sep{color:var(--muted);font-size:11px;}
.day-badge{font-size:10px;font-weight:700;padding:2px 9px;border-radius:99px;display:inline-block;}
.day-badge.j{background:rgba(91,156,246,.15);color:var(--j);}
.day-badge.p{background:rgba(251,146,60,.15);color:var(--p);}
.day-badge.tbd{background:rgba(255,255,255,.05);color:var(--muted);}
.today-line{position:absolute;top:0;left:0;right:0;height:2px;background:linear-gradient(90deg,transparent,var(--gold),transparent);}
.stakes-row-grid{display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:20px;animation:fadeUp .55s .34s ease both;}
.stakes-card{background:var(--bg2);border-radius:18px;overflow:hidden;border:1px solid var(--bd);}
.stakes-hd{padding:15px 20px;display:flex;align-items:center;gap:12px;}
.stakes-card.exempt .stakes-hd{background:linear-gradient(90deg,rgba(16,185,129,.12),transparent);border-bottom:1px solid rgba(16,185,129,.2);}
.stakes-card.edu    .stakes-hd{background:linear-gradient(90deg,rgba(244,63,94,.12),transparent);border-bottom:1px solid rgba(244,63,94,.2);}
.stakes-icon{font-size:22px;}
.stakes-ttl{font-size:14px;font-weight:800;}
.stakes-card.exempt .stakes-ttl{color:var(--win);}
.stakes-card.edu    .stakes-ttl{color:var(--lose);}
.stakes-desc{font-size:11px;color:var(--muted);}
.stakes-body{padding:14px 16px 16px;}
.s-row{display:flex;align-items:center;gap:10px;padding:9px 12px;border-radius:10px;margin-bottom:6px;background:rgba(255,255,255,.025);border:1px solid var(--bd);}
.s-rank{width:24px;height:24px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:11px;font-weight:800;flex-shrink:0;}
.exempt .s-rank{background:rgba(16,185,129,.15);color:var(--win);}
.edu    .s-rank{background:rgba(244,63,94,.15);color:var(--lose);}
.s-name-st{font-size:13px;font-weight:600;flex:1;}
.s-team-chip{font-size:10px;padding:2px 8px;border-radius:99px;font-weight:700;}
.s-team-chip.j{background:var(--js);color:var(--j);}
.s-team-chip.p{background:var(--ps);color:var(--p);}
.s-transfer{font-size:12px;font-weight:800;}
.exempt .s-transfer{color:var(--win);}
.edu    .s-transfer{color:var(--lose);}
.s-note{font-size:11px;color:var(--muted);padding:6px 4px 0;line-height:1.7;}

/* â”€â”€ ê°œì¸ ì ìˆ˜ í…Œì´ë¸” â”€â”€ */
.ind-wrap{background:var(--bg2);border:1px solid var(--bd);border-radius:18px;overflow:hidden;animation:fadeUp .55s .38s ease both;}
.ind-hd{padding:16px 24px;display:flex;justify-content:space-between;align-items:center;border-bottom:1px solid var(--bd);}
.date-nav{display:flex;align-items:center;gap:10px;}
.date-arrow{width:30px;height:30px;border:none;background:transparent;color:var(--j);font-size:17px;cursor:pointer;display:flex;align-items:center;justify-content:center;border-radius:6px;transition:all .2s;}
.date-arrow:hover{background:rgba(91,156,246,.15);transform:scale(1.1);}
.date-arrow:active{transform:scale(.95);}
.date-arrow:disabled{opacity:.3;cursor:not-allowed;transform:scale(1);}
.date-display{font-size:11px;font-weight:700;color:var(--muted);min-width:130px;text-align:center;}
.t-scroll{overflow-x:auto;padding:0 16px 16px;scroll-behavior:smooth;}

table{width:100%;border-collapse:separate;border-spacing:0;}

/* ê¸°ë³¸ í—¤ë” (ê³ ì • ì—´) */
thead th{
  padding:12px 8px;text-align:center;font-size:11px;font-weight:700;
  color:var(--sub);letter-spacing:.4px;
  border-bottom:1px solid var(--bd);
  white-space:nowrap;background:rgba(255,255,255,.04);
}
/* ë‚ ì§œ í—¤ë” */
thead th.date-th{
  background:rgba(91,156,246,.07);
  color:rgba(145,185,250,.85);
  border-left:1px solid rgba(91,156,246,.12);
  width:52px;min-width:52px;padding:12px 4px;
  z-index:1;
}

/* sticky ê³ ì • ì—´ */
thead th:first-child{text-align:left;padding-left:14px;position:sticky;left:0;background:var(--bg3);z-index:10;width:100px;}
thead th:nth-child(2){position:sticky;left:108px;background:var(--bg3);z-index:10;width:45px;}
thead th:nth-child(3){position:sticky;left:161px;background:var(--bg3);z-index:10;width:55px;}
thead th:nth-child(4){position:sticky;left:224px;background:var(--bg3);z-index:10;width:60px;}
thead th:nth-child(5){position:sticky;left:292px;background:var(--bg3);z-index:10;width:50px;}
thead th:nth-child(6){position:sticky;left:350px;background:var(--bg3);z-index:10;width:80px;box-shadow:3px 0 8px rgba(0,0,0,.6),2px 0 0 rgba(255,255,255,.10);}

tbody tr{transition:background .15s;}
tbody tr:hover{background:rgba(255,255,255,.025);}
td{padding:10px 8px;text-align:center;border-bottom:1px solid rgba(255,255,255,.03);font-size:12px;font-weight:500;white-space:nowrap;border-top:none;}

/* sticky body ì—´ */
td:first-child{text-align:left;font-weight:600;padding:10px 8px 10px 14px;position:sticky;left:0;background:var(--bg2);z-index:7;width:100px;}
td:nth-child(2){position:sticky;left:108px;background:var(--bg2);z-index:7;width:45px;}
td:nth-child(3){position:sticky;left:161px;background:var(--bg2);z-index:7;width:55px;}
td:nth-child(4){position:sticky;left:224px;background:var(--bg2);z-index:7;width:60px;}
td:nth-child(5){position:sticky;left:292px;background:var(--bg2);z-index:7;width:50px;}
td:nth-child(6){position:sticky;left:350px;background:var(--bg2);z-index:7;width:80px;box-shadow:3px 0 8px rgba(0,0,0,.6),2px 0 0 rgba(255,255,255,.08);}

/* ë‚ ì§œ td */
td.date-td{background:rgba(91,156,246,.03);z-index:1;width:52px;min-width:52px;padding:10px 4px;}
tbody tr:hover td:nth-child(-n+6){background:rgba(255,255,255,.04);}
tbody tr:hover td.date-td{background:rgba(91,156,246,.07);}

.group-hd-row td{padding:10px 8px;font-size:11px;font-weight:700;letter-spacing:.8px;border-top:2px solid var(--bd);border-bottom:1px solid var(--bd);position:sticky;left:0;background:rgba(0,0,0,.3);z-index:8;}
.group-hd-row.j td{color:var(--j);}
.group-hd-row.p td{color:var(--p);}

.team-chip{font-size:9px;padding:2px 6px;border-radius:6px;font-weight:700;display:inline-flex;align-items:center;justify-content:center;width:28px;height:24px;}
.team-chip.j{background:var(--js);color:var(--j);border:1px solid rgba(91,156,246,.25);}
.team-chip.p{background:var(--ps);color:var(--p);border:1px solid rgba(251,146,60,.25);}
.rank-dot{display:inline-block;width:6px;height:6px;border-radius:50%;margin-right:5px;vertical-align:middle;}
.member-name{display:flex;align-items:center;gap:3px;min-height:20px;}
.td-avg{font-size:12px;font-weight:800;}
.above-avg{color:var(--win);}
.below-avg{color:var(--lose);}
.cell-hi{color:var(--win);font-weight:700;}
.cell-z{color:var(--muted);}
.cell-null{color:rgba(255,255,255,.15);}
.rank-badge{font-size:10px;font-weight:700;padding:3px 6px;border-radius:4px;display:inline-block;margin-left:3px;vertical-align:middle;}
.rank-badge.top{background:rgba(16,185,129,.15);color:var(--win);border:1px solid rgba(16,185,129,.4);}
.rank-badge.bottom{background:rgba(244,63,94,.15);color:var(--lose);border:1px solid rgba(244,63,94,.4);}
.tag-exempt{font-size:9px;font-weight:700;background:rgba(16,185,129,.12);color:var(--win);border:1px solid rgba(16,185,129,.3);border-radius:5px;padding:1px 5px;margin-left:4px;vertical-align:middle;}
.tag-edu{font-size:9px;font-weight:700;background:rgba(244,63,94,.12);color:var(--lose);border:1px solid rgba(244,63,94,.3);border-radius:5px;padding:1px 5px;margin-left:4px;vertical-align:middle;}
.tag-position{font-size:9px;font-weight:600;color:var(--muted);background:rgba(255,255,255,.05);border:1px solid var(--bd);border-radius:4px;padding:1px 5px;margin-left:4px;vertical-align:middle;white-space:nowrap;}
.td-transfer{font-size:11px;font-weight:700;color:var(--gold);}
.td-transfer-zero{font-size:11px;color:var(--muted);}
.td-diff{font-size:11px;font-weight:700;}
.diff-positive{color:var(--win);}
.diff-negative{color:var(--lose);}
.comparison-cell{display:flex;align-items:center;justify-content:center;gap:2px;font-size:11px;font-weight:700;}

.update-badge{position:fixed;bottom:20px;right:20px;z-index:100;background:var(--bg2);border:1px solid var(--bd2);border-radius:12px;padding:8px 14px;font-size:11px;color:var(--muted);display:none;align-items:center;gap:8px;box-shadow:0 4px 20px rgba(0,0,0,.4);cursor:pointer;}
.update-badge:hover{border-color:var(--j);color:var(--text);}
.update-dot{width:6px;height:6px;border-radius:50%;background:var(--win);box-shadow:0 0 6px var(--win);}
@keyframes fadeDown{from{opacity:0;transform:translateY(-16px)}to{opacity:1;transform:translateY(0)}}
@keyframes fadeUp{from{opacity:0;transform:translateY(16px)}to{opacity:1;transform:translateY(0)}}
@keyframes blink{0%,100%{opacity:1}50%{opacity:.2}}
@media(max-width:720px){.score-hero-top{grid-template-columns:1fr auto 1fr;}.s-wins{font-size:42px;}.stakes-row-grid{grid-template-columns:1fr;}.score-side{padding:16px 18px;gap:12px;}}
@media(max-width:480px){.score-center{display:none;}.score-hero-top{grid-template-columns:1fr 1fr;}.s-wins{font-size:34px;}.recent5-bar{padding:8px 14px;}}
</style>
</head>
<body>
<div class="wrap">
<header>
  <div class="promo-chip">MBTI PROMOTION 2026</div>
  <h1>JíŒ€ vs PíŒ€</h1>
  <div class="subtitle">2026.02.23 ì‹œì‘ Â· í‰ì¼ ì´ 27ì¼ Â· ë¨¼ì € 15ìŠ¹ ë‹¬ì„± íŒ€ì´ ìµœì¢… ìŠ¹ë¦¬</div>
</header>

<div id="loading">
  <div class="spin">â³</div>
  <div class="loading-text">Google Sheets ì‹¤ì‹œê°„ ë°ì´í„° ë¡œë”© ì¤‘...</div>
  <div class="loading-sub">ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”</div>
</div>

<div id="error-msg">
  <div style="font-size:36px;margin-bottom:12px">âš ï¸</div>
  <div style="font-size:16px;font-weight:700;color:var(--lose);margin-bottom:8px">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤</div>
  <div style="font-size:13px;color:var(--muted)" id="error-detail"></div>
  <div style="margin-top:16px;font-size:12px;color:var(--muted)">êµ¬ê¸€ ì‹œíŠ¸ê°€ <b>ì›¹ì— ê²Œì‹œ</b>ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸í•´ì£¼ì„¸ìš”</div>
</div>

<div id="dashboard" style="display:none">
  <div class="score-hero">
    <div class="score-hero-top">
      <div class="score-side j">
        <div class="s-wins-wrap">
          <div class="s-wins" id="j-wins">â€”</div>
          <div class="s-unit">ìŠ¹</div>
        </div>
        <div class="s-meta">
          <div class="s-name">JíŒ€</div>
          <div class="s-need" id="j-need"></div>
        </div>
      </div>
      <div class="score-center">
        <div class="vs-txt">VS</div>
        <div class="target-chip">ğŸ† ëª©í‘œ 15ìŠ¹</div>
        <div class="days-info" id="days-info"></div>
      </div>
      <div class="score-side p">
        <div class="s-wins-wrap">
          <div class="s-wins" id="p-wins">â€”</div>
          <div class="s-unit">ìŠ¹</div>
        </div>
        <div class="s-meta">
          <div class="s-name">PíŒ€</div>
          <div class="s-need" id="p-need"></div>
        </div>
      </div>
    </div>
    <div class="recent5-bar">
      <div class="recent5-label">ìµœê·¼ 5ê²½ê¸°</div>
      <div class="recent5-cards" id="recent5-cards"></div>
    </div>
  </div>

  <!-- ë°°ë„ˆ 2ê°œ: ì—°ìŠ¹ + MVP -->
  <div class="banners-row">
    <div id="streak-banner" style="display:none"></div>
    <div id="mvp-banner" style="display:none"></div>
  </div>

  <div class="race-wrap">
    <div class="section-hd">
      <div class="section-title"><span class="live-dot"></span> ëˆ„ì  ìŠ¹ìˆ˜ ì¶”ì´</div>
      <div class="chart-legend">
        <div class="legend-item"><div class="legend-dot j"></div> JíŒ€</div>
        <div class="legend-item"><div class="legend-dot p"></div> PíŒ€</div>
        <div class="legend-item"><div class="legend-line-gold"></div> ëª©í‘œ 15ìŠ¹</div>
      </div>
    </div>
    <div class="chart-canvas-wrap"><canvas id="raceChart"></canvas></div>
    <!-- ë¯¸ë‹ˆ ë ˆì´ì‹±ë°” -->
    <div class="mini-race-outer">
      <div class="mini-finish"></div>
      <div class="mini-j-track"><div class="mini-j-fill" id="mini-j-fill" style="width:0%"></div></div>
      <div class="mini-j-car" id="mini-j-car" style="left:4px">ğŸš™</div>
      <div class="mini-p-track"><div class="mini-p-fill" id="mini-p-fill" style="width:0%"></div></div>
      <div class="mini-p-car" id="mini-p-car" style="right:4px">ğŸš•</div>
    </div>
    <div class="mini-race-score-row">
      <span class="rs-j" id="race-j-label"></span>
      <span class="rs-mid">ğŸ 15ìŠ¹ ê²°ìŠ¹ì„ </span>
      <span class="rs-p" id="race-p-label"></span>
    </div>
  </div>

  <!-- ì˜ˆì¸¡ ë¶„ì„ -->
  <div class="forecast-wrap">
    <div class="section-hd">
      <div class="section-title"><span style="font-size:15px">ğŸ”®</span> ì˜ˆì¸¡ ë¶„ì„</div>
      <div class="section-meta" id="forecast-meta"></div>
    </div>
    <div class="forecast-grid" id="forecast-grid"></div>
    <div class="forecast-note" id="forecast-note"></div>
  </div>

  <div class="weekly-wrap">
    <div class="section-hd">
      <div class="section-title"><span style="font-size:16px">ğŸ“…</span> ì£¼ì°¨ë³„ ì¼ë³„ ìŠ¹íŒ¨</div>
      <div class="section-meta" id="week-meta"></div>
    </div>
    <div id="weeks-container"></div>
  </div>

  <div class="stakes-row-grid">
    <div class="stakes-card exempt">
      <div class="stakes-hd">
        <div class="stakes-icon">ğŸ†</div>
        <div>
          <div class="stakes-ttl">ë‹¤ìŒ í”„ë¡œëª¨ì…˜ ë©´ì œ</div>
          <div class="stakes-desc">ìŠ¹ë¦¬íŒ€ ì´ê´€ë§¤ì¶œ ìƒìœ„ 2ì¸ (ì¸í„´ ì œì™¸)</div>
        </div>
      </div>
      <div class="stakes-body" id="exempt-body"></div>
    </div>
    <div class="stakes-card edu">
      <div class="stakes-hd">
        <div class="stakes-icon">ğŸ“š</div>
        <div>
          <div class="stakes-ttl">ë ˆí¼ëŸ°ìŠ¤ êµìœ¡</div>
          <div class="stakes-desc">íŒ¨ë°°íŒ€ ì´ê´€ë§¤ì¶œ í•˜ìœ„ 2ì¸ (ì¸í„´ ì œì™¸)</div>
        </div>
      </div>
      <div class="stakes-body" id="edu-body"></div>
    </div>
  </div>

  <div class="ind-wrap">
    <div class="ind-hd">
      <div class="section-title">
        <span style="font-size:15px">ğŸ“Š</span> ì „ì²´ ê°œì¸ ì ìˆ˜ í˜„í™©
        <span style="font-size:11px;font-weight:500;color:var(--muted);margin-left:4px">â­ ìƒëŒ€íŒ€ í‰ê·  ìƒíšŒ &nbsp;ğŸ’ª ìƒëŒ€íŒ€ í‰ê·  ë¯¸ë‹¬</span>
      </div>
      <div class="date-nav">
        <button class="date-arrow" id="prevBtn" onclick="prevDates()" title="ì´ì „ ë‚ ì§œ">â—€</button>
        <div class="date-display" id="dateDisplay"></div>
        <button class="date-arrow" id="nextBtn" onclick="nextDates()" title="ë‹¤ìŒ ë‚ ì§œ">â–¶</button>
      </div>
    </div>
    <div class="t-scroll"><table id="main-table"></table></div>
  </div>
</div>
</div>

<div class="update-badge" id="update-badge" onclick="loadData()" title="í´ë¦­í•˜ë©´ ìƒˆë¡œê³ ì¹¨">
  <div class="update-dot"></div>
  <span id="update-time"></span> &nbsp;ğŸ”„
</div>

<script>
/* â•â•â•â•â•â• CONFIG â•â•â•â•â•â• */
const CSV_URL     = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQwLn1ITezcGkfgKkd_B9_MwrTbllcubuHp1FpPjoucTMc7j0P4Ek6XBfvmYn_eHrhFc2-6KtuTOBR9/pub?gid=0&single=true&output=csv';
const TARGET      = 15;
const TOTAL_WD    = 27;
const INTERN_RANK = 'ì¸í„´';
const VISIBLE_DATES = 9;

const WEEK_SCHEDULE = [
  { label:'1ì£¼ì°¨', dates:['02ì›” 23ì¼','02ì›” 24ì¼','02ì›” 25ì¼','02ì›” 26ì¼','02ì›” 27ì¼'] },
  { label:'2ì£¼ì°¨', dates:['03ì›” 02ì¼','03ì›” 03ì¼','03ì›” 04ì¼','03ì›” 05ì¼','03ì›” 06ì¼'] },
  { label:'3ì£¼ì°¨', dates:['03ì›” 09ì¼','03ì›” 10ì¼','03ì›” 11ì¼','03ì›” 12ì¼','03ì›” 13ì¼'] },
  { label:'4ì£¼ì°¨', dates:['03ì›” 16ì¼','03ì›” 17ì¼','03ì›” 18ì¼','03ì›” 19ì¼','03ì›” 20ì¼'] },
  { label:'5ì£¼ì°¨', dates:['03ì›” 23ì¼','03ì›” 24ì¼','03ì›” 25ì¼','03ì›” 26ì¼','03ì›” 27ì¼'] },
  { label:'6ì£¼ì°¨', dates:['03ì›” 30ì¼','03ì›” 31ì¼'] },
];

/* â•â•â•â•â•â• CSV PARSER â•â•â•â•â•â• */
function parseCSV(text) {
  return text.replace(/\r/g,'').split('\n').map(line => {
    const cells=[]; let cur='', inQ=false;
    for(const ch of line){
      if(ch==='"'){inQ=!inQ;}
      else if(ch===','&&!inQ){cells.push(cur.trim());cur='';}
      else cur+=ch;
    }
    cells.push(cur.trim());
    return cells;
  });
}

const isDate = s => /\d+ì›”\s*\d+ì¼/.test((s||'').trim());
const toNum  = s => { const v=parseFloat((s||'').replace(/[^0-9.-]/g,'')); return isNaN(v)?0:v; };
const fix2   = v => Math.round(v*100)/100;
const avgArr = a => a.length ? a.reduce((s,v)=>s+v,0)/a.length : 0;
const shortD = d => d.replace(/0?(\d+)ì›”\s*0?(\d+)ì¼/,(_,m,day)=>String(m).padStart(2,'0')+'/'+String(day).padStart(2,'0'));

/* â•â•â•â•â•â• DATA PARSER â•â•â•â•â•â• */
function parseData(rows) {
  let section=null, dateHeaders=[];
  const jTeam=[], pTeam=[];

  for(const row of rows){
    const c=row.map(s=>(s||'').trim());
    if(c[1]==='JíŒ€'&&c[3]==='í‰ê· '){section='jScore';dateHeaders=row.slice(4).map(s=>s.trim()).filter(isDate);continue;}
    if(c[1]==='PíŒ€'&&c[3]==='í‰ê· '){section='pScore';continue;}
    if(c[1]==='JíŒ€'&&c[2]==='ì´ê´€ë§¤ì¶œ'&&isDate(c[3])){section='jTransfer';continue;}
    if(c[1]==='PíŒ€'&&c[2]==='ì´ê´€ë§¤ì¶œ'&&isDate(c[3])){section='pTransfer';continue;}
    if(!c[0]||!c[1]||c[1]==='ì¼í‰ê· ')continue;

    const rank=c[0], name=c[1];
    if(section==='jScore'||section==='pScore'){
      const m={rank,name,isIntern:rank===INTERN_RANK,transfer:toNum(c[2]),avg:toNum(c[3]),
        scores:dateHeaders.map((_,i)=>{const r=(row[4+i]||'').trim();return r===''?null:toNum(r);}),
        dailyTransfer:new Array(dateHeaders.length).fill(0)};
      section==='jScore'?jTeam.push(m):pTeam.push(m);
    }
    else if(section==='jTransfer'){
      const m=jTeam.find(x=>x.name===name);
      if(m){m.transfer=toNum(c[2]);m.dailyTransfer=dateHeaders.map((_,i)=>toNum((row[3+i]||'').trim()));}
    }
    else if(section==='pTransfer'){
      const m=pTeam.find(x=>x.name===name);
      if(m){m.transfer=toNum(c[2]);m.dailyTransfer=dateHeaders.map((_,i)=>toNum((row[3+i]||'').trim()));}
    }
  }
  return {dateHeaders,jTeam,pTeam};
}

/* â•â•â•â•â•â• í˜ì´ì§€ë„¤ì´ì…˜ ìƒíƒœ â•â•â•â•â•â• */
let _pagedDates = [];   // ìµœì‹ â†’ê³¼ê±° ìˆœ ì •ë ¬ëœ ì‹¤ì œ ë‚ ì§œ ë°°ì—´ (MM/DD)
let _pagedHeaders = []; // ê°™ì€ ìˆœì„œì˜ ì›ë³¸ dateHeaders ë°°ì—´
let _pagedData = null;  // {jTeam, pTeam, jTeamAvg, pTeamAvg, exemptNames, eduNames}
let _pageIndex = 0;     // 0 = ê°€ì¥ ìµœì‹ 

function prevDates(){
  if(_pageIndex > 0){ _pageIndex = Math.max(0, _pageIndex - VISIBLE_DATES); renderIndividualTable(); }
}
function nextDates(){
  if(_pageIndex + VISIBLE_DATES < _pagedDates.length){ _pageIndex = Math.min(_pagedDates.length - VISIBLE_DATES, _pageIndex + VISIBLE_DATES); renderIndividualTable(); }
}

function renderIndividualTable(){
  if(!_pagedData || !_pagedDates.length) return;
  const { jTeam, pTeam, jTeamAvg, pTeamAvg, exemptNames, eduNames } = _pagedData;

  const total = _pagedDates.length;
  const startIdx = _pageIndex;
  const endIdx = Math.min(_pageIndex + VISIBLE_DATES, total);
  const sliceDates = _pagedDates.slice(startIdx, endIdx);     // MM/DD í‘œì‹œìš©
  const sliceHeaders = _pagedHeaders.slice(startIdx, endIdx); // ì›ë³¸ dateHeaders ì¸ë±ìŠ¤ ê³„ì‚°ìš©

  // ë‚ ì§œ í‘œì‹œ ì—…ë°ì´íŠ¸
  if(sliceDates.length){
    document.getElementById('dateDisplay').textContent = sliceDates[0] + ' ~ ' + sliceDates[sliceDates.length-1];
  }
  document.getElementById('prevBtn').disabled = startIdx === 0;
  document.getElementById('nextBtn').disabled = endIdx >= total;

  // ìŠ¬ë¼ì´ìŠ¤ëœ ë‚ ì§œì— í•´ë‹¹í•˜ëŠ” ì›ë˜ dateHeaders ì¸ë±ìŠ¤ ë§µí•‘
  const sliceOriginalIdx = sliceHeaders.map(h => _allDateHeaders.indexOf(h));

  let html = `<thead><tr>
    <th>ì´ë¦„</th><th>íŒ€</th><th>í‰ê· </th><th>ì´ê´€ë§¤ì¶œ</th><th>íŒ€æ¯”</th><th>ìƒëŒ€íŒ€æ¯”</th>`;
  sliceDates.forEach(d => { html += `<th class="date-th">${d}</th>`; });
  html += `</tr></thead><tbody>`;

  const renderTeam = (team, myAvg, oppAvg, chip) => {
    html += `<tr class="group-hd-row ${chip}"><td colspan="${6 + sliceDates.length}">${chip.toUpperCase()}íŒ€ Â· íŒ€ ì¼í‰ê·  ${myAvg}</td></tr>`;
    const sorted = [...team].sort((a,b) => b.transfer - a.transfer);
    const topTransfer = new Set(sorted.filter(m=>!m.isIntern).slice(0,2).map(m=>m.name));
    const bottomTransfer = new Set(sorted.filter(m=>!m.isIntern).slice(-2).map(m=>m.name));

    [...team].sort((a,b) => b.avg - a.avg).forEach(m => {
      const aT = m.avg >= myAvg;
      const aO = m.avg >= oppAvg;
      const tC = aO ? 'var(--win)' : 'var(--lose)';
      const tDiff = fix2(m.avg - myAvg);
      const oDiff = fix2(m.avg - oppAvg);

      let badgeHtml = '';
      if(exemptNames.has(m.name))      badgeHtml = '<span class="rank-badge top">ë©´ì œ</span>';
      else if(eduNames.has(m.name))    badgeHtml = '<span class="rank-badge bottom">êµìœ¡</span>';

      html += `<tr>
        <td><div class="member-name"><span class="rank-dot" style="background:${tC}"></span>${m.name}<span class="tag-position">${m.rank}</span>${badgeHtml}</div></td>
        <td><span class="team-chip ${chip}">${chip.toUpperCase()}</span></td>
        <td class="td-avg ${aT?'above-avg':'below-avg'}">${m.avg}</td>
        <td class="${m.transfer>0?'td-transfer':'td-transfer-zero'}">${m.transfer>0?(m.transfer/10000).toFixed(0)+'ë§Œ':'-'}</td>
        <td class="td-diff ${tDiff>=0?'diff-positive':'diff-negative'}">${tDiff>=0?'+':''}${tDiff}</td>
        <td><div class="comparison-cell"><span>${aO?'â­':'ğŸ’ª'}</span><span style="color:${aO?'var(--win)':'var(--lose)'};font-weight:700">${oDiff>=0?'+':''}${oDiff}</span></div></td>`;

      sliceOriginalIdx.forEach(origIdx => {
        const v = origIdx >= 0 ? m.scores[origIdx] : null;
        let cls = 'date-td';
        let content = 'â€”';
        if(v !== null && v !== undefined){
          content = v;
          if(v >= 10) cls += ' cell-hi';
          else if(v === 0) cls += ' cell-z';
        } else {
          cls += ' cell-null';
        }
        html += `<td class="${cls}">${content}</td>`;
      });

      html += `</tr>`;
    });
  };

  renderTeam(jTeam, jTeamAvg, pTeamAvg, 'j');
  renderTeam(pTeam, pTeamAvg, jTeamAvg, 'p');
  html += '</tbody>';
  document.getElementById('main-table').innerHTML = html;
}

// ì „ì—­ ì›ë³¸ dateHeaders ì°¸ì¡° (ì¸ë±ìŠ¤ ê³„ì‚°ìš©)
let _allDateHeaders = [];

/* â•â•â•â•â•â• RENDER â•â•â•â•â•â• */
function render({dateHeaders, jTeam, pTeam}){
  _allDateHeaders = dateHeaders;

  const dayAvg=(team,i)=>{const v=team.map(m=>m.scores[i]).filter(v=>v!==null);return v.length?fix2(avgArr(v)):null;};
  const dayResults={};
  dateHeaders.forEach((d,i)=>{
    const jA=dayAvg(jTeam,i),pA=dayAvg(pTeam,i);
    if(jA===null&&pA===null)return;
    dayResults[d]={j:jA??0,p:pA??0,winner:(jA??0)>=(pA??0)?'j':'p'};
  });
  const playedDates=dateHeaders.filter(d=>dayResults[d]);
  const jWins=playedDates.filter(d=>dayResults[d].winner==='j').length;
  const pWins=playedDates.filter(d=>dayResults[d].winner==='p').length;
  const played=playedDates.length, remaining=TOTAL_WD-played;
  const jTeamAvg=fix2(avgArr(jTeam.map(m=>m.avg)));
  const pTeamAvg=fix2(avgArr(pTeam.map(m=>m.avg)));
  const now=new Date();
  const todayLabel=`${String(now.getMonth()+1).padStart(2,'0')}ì›” ${String(now.getDate()).padStart(2,'0')}ì¼`;

  // Score Hero
  document.getElementById('j-wins').textContent=`${jWins}`;
  document.getElementById('p-wins').textContent=`${pWins}`;
  document.getElementById('j-need').textContent=`${TARGET-jWins}ìŠ¹ í•„ìš”`;
  document.getElementById('p-need').textContent=`${TARGET-pWins}ìŠ¹ í•„ìš”`;
  document.getElementById('days-info').innerHTML=`${played}ì¼ ì§„í–‰<br>${remaining}ì¼ ë‚¨ìŒ`;

  // ìµœê·¼ 5ê²½ê¸° ì¹´ë“œ
  (function renderRecent5(){
    const cont = document.getElementById('recent5-cards');
    if(!cont) return;
    const recent = playedDates.slice(-5);
    cont.innerHTML = '';
    // 5ì¹¸ í•­ìƒ í‘œì‹œ (ì—†ìœ¼ë©´ ë¹ˆ ì¹¸)
    for(let i=0;i<5;i++){
      const d = recent[i];
      const card = document.createElement('div');
      if(d){
        const res = dayResults[d];
        card.className = `r5-card r5-${res.winner}`;
        card.innerHTML = `<div class="r5-date">${shortD(d)}</div><div class="r5-winner">${res.winner==='j'?'JìŠ¹':'PìŠ¹'}</div><div class="r5-score">${res.j} : ${res.p}</div>`;
      } else {
        card.className = 'r5-card r5-empty';
        card.innerHTML = `<div class="r5-date">â€”</div><div class="r5-winner" style="color:var(--muted)">â€”</div>`;
      }
      cont.appendChild(card);
    }
  })();

  // â”€â”€ ìŠ¤íŠ¸ë¦­ ë°°ë„ˆ (ì—°ìŠ¹) + MVP ë°°ë„ˆ â”€â”€
  (function renderBanners(){
    const streakBanner = document.getElementById('streak-banner');
    const mvpBanner = document.getElementById('mvp-banner');
    if(!streakBanner || !mvpBanner || played < 1) return;

    // â”€â”€ ì—°ìŠ¹ ê³„ì‚° â”€â”€
    let streak = 0, streakTeam = null;
    for(let i = playedDates.length - 1; i >= 0; i--){
      const w = dayResults[playedDates[i]].winner;
      if(streakTeam === null) streakTeam = w;
      if(w === streakTeam) streak++;
      else break;
    }

    // â”€â”€ ì—°ìŠ¹ ë°°ë„ˆ ë Œë”ë§ â”€â”€
    const recentDots = playedDates.slice(-5).map(d => {
      const w = dayResults[d].winner;
      const isLast = d === playedDates[playedDates.length-1];
      return `<div class="s-dot ${isLast && streak >= 2 ? 'fire' : w}">${w==='j'?'J':'P'}</div>`;
    }).join('');

    let streakIcon, streakMain, streakSub, streakCls;
    if(streak >= 3){
      streakCls = streakTeam;
      streakIcon = 'ğŸ”¥';
      streakMain = `<em>${streak}ì—°ìŠ¹</em> ${streakTeam==='j'?'J':'P'}íŒ€ ì§ˆì£¼ ì¤‘!`;
      streakSub = `${streak}ì¼ ì—°ì† ìš°ì„¸ Â· ìƒëŒ€íŒ€ ë°˜ì „ì´ í•„ìš”í•œ ì‹œì `;
    } else if(streak === 2){
      streakCls = streakTeam;
      streakIcon = 'âš¡';
      streakMain = `${streakTeam==='j'?'J':'P'}íŒ€ <em>2ì—°ìŠ¹</em> ë‹¬ì„±!`;
      streakSub = `ì—°ì† íë¦„ ì¡ëŠ” ì¤‘ Â· ì˜¤ëŠ˜ë„ ì§‘ì¤‘`;
    } else if(Math.abs(jWins - pWins) <= 1){
      streakCls = 'j';
      streakIcon = 'âš”ï¸';
      streakMain = `ì´ˆì ‘ì „! <em>${jWins}ìŠ¹</em> vs <em>${pWins}ìŠ¹</em>`;
      streakSub = `í•œ ê²½ê¸° ì°¨ì´ Â· ë§¤ì¼ì´ ë¶„ìˆ˜ë ¹`;
    } else {
      const leading = jWins > pWins ? 'j' : 'p';
      const diff = Math.abs(jWins - pWins);
      streakCls = leading;
      streakIcon = 'ğŸš€';
      streakMain = `${leading==='j'?'J':'P'}íŒ€ <em>${diff}ìŠ¹ ì°¨</em> ë¦¬ë“œ`;
      streakSub = `í˜„ì¬ ${leading==='j'?'J':'P'}íŒ€ í˜ì´ìŠ¤ ìš°ì„¸`;
    }

    streakBanner.className = `streak-banner ${streakCls}-streak`;
    streakBanner.style.display = 'flex';
    streakBanner.innerHTML = `
      <div class="streak-icon">${streakIcon}</div>
      <div class="streak-body">
        <div class="streak-main ${streakCls}">${streakMain}</div>
        <div class="streak-sub">${streakSub}</div>
      </div>
      <div class="streak-dots">${recentDots}</div>
    `;

    // â”€â”€ MVP ë°°ë„ˆ: ì „ë‚ (ê°€ì¥ ìµœê·¼ ê²½ê¸°ì¼) ìŠ¹íŒ€ ê¸°ì—¬ë„ 1ìœ„ â”€â”€
    const latestDate = playedDates[playedDates.length - 1];
    const latestIdx = _allDateHeaders.indexOf(latestDate);
    if(latestIdx < 0){ mvpBanner.style.display='none'; return; }

    const latestRes = dayResults[latestDate];
    const winTeamMembers = latestRes.winner === 'j' ? jTeam : pTeam;
    const winTeamLabel = latestRes.winner === 'j' ? 'J' : 'P';
    const winTeamCls = latestRes.winner;

    // ìŠ¹íŒ€ ë©¤ë²„ ì¤‘ í•´ë‹¹ ë‚  ìµœê³  ì ìˆ˜ ì°¾ê¸°
    let mvpMember = null, mvpScore = -1;
    winTeamMembers.forEach(m => {
      const s = m.scores[latestIdx];
      if(s !== null && s > mvpScore){ mvpScore = s; mvpMember = m; }
    });

    if(!mvpMember){ mvpBanner.style.display='none'; return; }

    mvpBanner.className = `streak-banner mvp-banner`;
    mvpBanner.style.display = 'flex';
    mvpBanner.innerHTML = `
      <div class="streak-body">
        <div class="streak-main gold">â­ MVP Â· ${mvpMember.name}</div>
        <div class="streak-sub">${shortD(latestDate)} ${winTeamLabel}íŒ€ ìŠ¹ë¦¬ ìµœë‹¤ ê¸°ì—¬ Â· ${mvpScore}ì </div>
        <div><span class="mvp-badge">âœ¨ ${winTeamLabel}íŒ€ ê¸°ì—¬ë„ 1ìœ„</span></div>
      </div>
      <div class="streak-icon" style="font-size:26px;flex-shrink:0;">ğŸ…</div>
    `;
  })();

  // â”€â”€ ëˆ„ì  ìŠ¹ìˆ˜ ì¶”ì´ ì°¨íŠ¸ (ì „ì²´ ë‚ ì§œ ê¸°ì¤€) â”€â”€
  (function drawChart(){
    const canvas = document.getElementById('raceChart');
    if(!canvas) return;
    const ctx = canvas.getContext('2d');

    // ì „ì²´ ìŠ¤ì¼€ì¤„ ë‚ ì§œ (ëŒ€ì²´ê³µíœ´ì¼ ì œì™¸) ê¸°ì¤€ìœ¼ë¡œ ì¶• êµ¬ì„±
    const HOLIDAYS = ['03ì›” 02ì¼'];
    const allScheduleDates = WEEK_SCHEDULE.flatMap(w => w.dates).filter(d => !HOLIDAYS.includes(d));

    const labels = ['ì‹œì‘'];
    const jCum = [0], pCum = [0];
    const isPlayed = []; // ê° í¬ì¸íŠ¸ê°€ ì‹¤ì œ ê²½ê¸° ì—¬ë¶€
    isPlayed.push(false);
    let jAcc=0, pAcc=0;
    allScheduleDates.forEach(d => {
      labels.push(shortD(d));
      if(dayResults[d]){
        if(dayResults[d].winner==='j') jAcc++; else pAcc++;
        jCum.push(jAcc); pCum.push(pAcc);
        isPlayed.push(true);
      } else {
        jCum.push(null); pCum.push(null);
        isPlayed.push(false);
      }
    });

    function draw(){
      const wrap = canvas.parentElement;
      const W = wrap.clientWidth;
      const H = wrap.clientHeight;
      if(W === 0 || H === 0){ requestAnimationFrame(draw); return; }
      canvas.width = W;
      canvas.height = H;
      const PAD={top:14, right:48, bottom:28, left:32};
      const cW=W-PAD.left-PAD.right, cH=H-PAD.top-PAD.bottom;
      const MAX=TARGET, n=labels.length;
      ctx.clearRect(0,0,W,H);

      // ê·¸ë¦¬ë“œ
      [0,5,10,15].forEach(v=>{
        const y=PAD.top+cH-(v/MAX)*cH;
        ctx.strokeStyle='rgba(255,255,255,.05)';ctx.lineWidth=1;
        ctx.beginPath();ctx.moveTo(PAD.left,y);ctx.lineTo(PAD.left+cW,y);ctx.stroke();
        ctx.fillStyle='rgba(255,255,255,.25)';
        ctx.font='10px Pretendard,sans-serif';ctx.textAlign='right';
        ctx.fillText(v,PAD.left-5,y+4);
      });

      // ëª©í‘œì„ 
      ctx.strokeStyle='rgba(251,191,36,.5)';ctx.lineWidth=1.5;ctx.setLineDash([6,4]);
      ctx.beginPath();ctx.moveTo(PAD.left,PAD.top);ctx.lineTo(PAD.left+cW,PAD.top);ctx.stroke();
      ctx.setLineDash([]);

      // ì˜¤ëŠ˜ ì´í›„ ë¯¸ê²½ê¸° êµ¬ê°„ ìŒì˜
      const firstNull = jCum.findIndex((v,i)=>i>0&&v===null);
      if(firstNull > 0){
        const xStart = PAD.left+(firstNull/(n-1))*cW;
        ctx.fillStyle='rgba(255,255,255,.018)';
        ctx.fillRect(xStart, PAD.top, PAD.left+cW-xStart, cH);
        // "ì˜ˆì •" í…ìŠ¤íŠ¸
        ctx.fillStyle='rgba(255,255,255,.1)';
        ctx.font='10px Pretendard,sans-serif';ctx.textAlign='left';
        ctx.fillText('â† ì˜ˆì •', xStart+6, PAD.top+14);
      }

      const xP = i => PAD.left+(i/(n-1))*cW;
      const yP = v => PAD.top+cH-(v/MAX)*cH;

      // ê²½ê¸° ì™„ë£Œ êµ¬ê°„ë§Œ ì—°ê²°í•˜ëŠ” ì„ /ë©´ì  ê·¸ë¦¬ê¸°
      function getSegments(data){
        const segs = []; let seg = [];
        data.forEach((v,i)=>{
          if(v !== null){ seg.push({i,v}); }
          else if(seg.length){ segs.push(seg); seg=[]; }
        });
        if(seg.length) segs.push(seg);
        return segs;
      }

      function drawArea(data,r,g,b){
        const grad=ctx.createLinearGradient(0,PAD.top,0,PAD.top+cH);
        grad.addColorStop(0,`rgba(${r},${g},${b},.18)`);
        grad.addColorStop(1,`rgba(${r},${g},${b},.01)`);
        const segs = getSegments(data);
        segs.forEach(seg=>{
          if(seg.length < 2) return;
          ctx.beginPath();
          ctx.moveTo(xP(seg[0].i),yP(seg[0].v));
          seg.forEach(p=>ctx.lineTo(xP(p.i),yP(p.v)));
          ctx.lineTo(xP(seg[seg.length-1].i),PAD.top+cH);
          ctx.lineTo(xP(seg[0].i),PAD.top+cH);
          ctx.closePath();ctx.fillStyle=grad;ctx.fill();
        });
      }

      function drawLine(data,color){
        const segs = getSegments(data);
        ctx.strokeStyle=color;ctx.lineWidth=2.5;ctx.lineJoin='round';
        segs.forEach(seg=>{
          if(seg.length < 1) return;
          ctx.beginPath();
          seg.forEach((p,i)=>i===0?ctx.moveTo(xP(p.i),yP(p.v)):ctx.lineTo(xP(p.i),yP(p.v)));
          ctx.stroke();
        });
      }

      function drawDots(data,color){
        getSegments(data).flat().forEach(p=>{
          if(p.i===0) return;
          ctx.beginPath();ctx.arc(xP(p.i),yP(p.v),3.5,0,Math.PI*2);
          ctx.fillStyle=color;ctx.fill();
          ctx.strokeStyle='rgba(9,9,15,.9)';ctx.lineWidth=1.5;ctx.stroke();
        });
      }

      function drawEndLabel(data,color,alignRight){
        const lastSeg = getSegments(data);
        if(!lastSeg.length) return;
        const last = lastSeg[lastSeg.length-1].slice(-1)[0];
        if(!last) return;
        ctx.fillStyle=color;ctx.font='bold 11px Pretendard,sans-serif';
        ctx.textAlign=alignRight?'right':'left';
        ctx.fillText(last.v+'ìŠ¹', xP(last.i)+(alignRight?-8:8), yP(last.v)-6);
      }

      drawArea(jCum,91,156,246);drawArea(pCum,251,146,60);
      drawLine(jCum,'#5b9cf6');drawLine(pCum,'#fb923c');
      drawDots(jCum,'#5b9cf6');drawDots(pCum,'#fb923c');
      drawEndLabel(jCum,'#5b9cf6',false);drawEndLabel(pCum,'#fb923c',false);

      // X ë¼ë²¨: ì£¼ì°¨ ì‹œì‘ì¼ë§Œ
      const weekStarts = new Set(WEEK_SCHEDULE.map(w=>w.dates[0]).filter(d=>!HOLIDAYS.includes(d)).map(d=>shortD(d)));
      weekStarts.add(shortD(allScheduleDates[allScheduleDates.length-1]));
      ctx.fillStyle='rgba(255,255,255,.28)';
      ctx.font='10px Pretendard,sans-serif';ctx.textAlign='center';
      labels.forEach((l,i)=>{
        if(weekStarts.has(l)) ctx.fillText(l,xP(i),H-4);
      });
    }
    requestAnimationFrame(()=>{ requestAnimationFrame(draw); });
    window.addEventListener('resize', draw);
  })();

  // â”€â”€ ë¯¸ë‹ˆ ë ˆì´ì‹±ë°” â”€â”€
  document.getElementById('race-j-label').textContent=`â† JíŒ€ ${jWins}ìŠ¹`;
  document.getElementById('race-p-label').textContent=`PíŒ€ ${pWins}ìŠ¹ â†’`;
  setTimeout(()=>{
    const jP=Math.min((jWins/TARGET)*100,100), pP=Math.min((pWins/TARGET)*100,100);
    document.getElementById('mini-j-fill').style.width=jP+'%';
    document.getElementById('mini-p-fill').style.width=pP+'%';
    const jTW=document.querySelector('.mini-j-track').offsetWidth;
    const pTW=document.querySelector('.mini-p-track').offsetWidth;
    document.getElementById('mini-j-car').style.left=Math.max(4,4+(jP/100)*(jTW-32))+'px';
    document.getElementById('mini-p-car').style.right=Math.max(4,4+(pP/100)*(pTW-32))+'px';
  },400);

  // â”€â”€ ê³ ë„í™” ì˜ˆì¸¡ ë¶„ì„ â”€â”€
  (function renderForecast(){
    const fGrid=document.getElementById('forecast-grid');
    const fNote=document.getElementById('forecast-note');
    const fMeta=document.getElementById('forecast-meta');
    if(!fGrid) return;

    if(played < 2){
      fGrid.innerHTML='';
      fNote.textContent='ì§„í–‰ ë°ì´í„°ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤. 2ì¼ ì´ìƒ ê²½ê³¼ í›„ ì˜ˆì¸¡ì´ í‘œì‹œë©ë‹ˆë‹¤.';
      return;
    }

    // â‘  ê¸°ë³¸ ìŠ¹ë¥ 
    const jRate = jWins/played;
    const pRate = pWins/played;

    // â‘¡ ìµœê·¼ 3ê²½ê¸° ê°€ì¤‘ ìŠ¹ë¥  (ìµœê·¼ì¼ìˆ˜ë¡ 2ë°° ê°€ì¤‘)
    const recent = playedDates.slice(-Math.min(3,played));
    let jRecW=0, pRecW=0, wSum=0;
    recent.forEach((d,i)=>{
      const w=i+1; wSum+=w;
      if(dayResults[d].winner==='j') jRecW+=w; else pRecW+=w;
    });
    const jRecentRate = jRecW/wSum;
    const pRecentRate = pRecW/wSum;

    // â‘¢ ì ìˆ˜ íŠ¸ë Œë“œ (ìµœê·¼ 3ì¼ í‰ê·  vs ì „ì²´ í‰ê· )
    const jAllScores = playedDates.map(d=>dayResults[d].j);
    const pAllScores = playedDates.map(d=>dayResults[d].p);
    const jRecentScores = jAllScores.slice(-3);
    const pRecentScores = pAllScores.slice(-3);
    const jScoreTrend = (jRecentScores.reduce((a,b)=>a+b,0)/jRecentScores.length) - (jAllScores.reduce((a,b)=>a+b,0)/jAllScores.length);
    const pScoreTrend = (pRecentScores.reduce((a,b)=>a+b,0)/pRecentScores.length) - (pAllScores.reduce((a,b)=>a+b,0)/pAllScores.length);

    // â‘£ ì¢…í•© ì˜ˆì¸¡ ìŠ¹ë¥ : ì „ì²´ 50% + ìµœê·¼ 50% + íŠ¸ë Œë“œ ë³´ì •
    let jPred = jRate*0.5 + jRecentRate*0.5;
    let pPred = pRate*0.5 + pRecentRate*0.5;
    // íŠ¸ë Œë“œ ë³´ì •: ì ìˆ˜ ì°¨ì´ ê¸°ì¤€ Â±5% ì´ë‚´
    const trendBonus = Math.min(0.05, Math.abs(jScoreTrend - pScoreTrend)/20);
    if(jScoreTrend > pScoreTrend) jPred = Math.min(0.95, jPred+trendBonus);
    else pPred = Math.min(0.95, pPred+trendBonus);
    // í•©ê³„ 1ë¡œ ì •ê·œí™”
    const total = jPred+pPred;
    jPred /= total; pPred /= total;

    // â‘¤ ì˜ˆìƒ ì¢…ë£Œì¼ ê³„ì‚°: ê°íŒ€ ë‚¨ì€ ìŠ¹ìˆ˜ / ì˜ˆì¸¡ ìŠ¹ë¥  â†’ í•„ìš” ë‚¨ì€ ê²½ê¸°ìˆ˜
    const HOLIDAYS = ['03ì›” 02ì¼']; // ëŒ€ì²´ê³µíœ´ì¼
    const allFutureDates = WEEK_SCHEDULE.flatMap(w=>w.dates).filter(d=>!dayResults[d]&&!HOLIDAYS.includes(d));
    const jNeed = TARGET - jWins;
    const pNeed = TARGET - pWins;
    // ê°íŒ€ì´ ë‚¨ì€ ê²½ê¸°ì—ì„œ í•„ìš” ìŠ¹ìˆ˜ ë‹¬ì„±í•˜ëŠ” ì‹œë®¬: E[ê²½ê¸°ìˆ˜] = need/rate
    const jDaysNeeded = Math.ceil(jNeed / jPred);
    const pDaysNeeded = Math.ceil(pNeed / pPred);
    const winnerDays = Math.min(jDaysNeeded, pDaysNeeded);
    const predictedEndDate = allFutureDates[Math.min(winnerDays-1, allFutureDates.length-1)];
    const predictedWinner = jDaysNeeded <= pDaysNeeded ? 'J' : 'P';
    const predictedEndStr = predictedEndDate ? shortD(predictedEndDate) : 'ê¸°ê°„ ë‚´';

    // â‘¥ ì ìˆ˜ ë³€ë™ì„± (í‘œì¤€í¸ì°¨ ê¸°ë°˜ ë¶ˆí™•ì‹¤ì„±)
    const jStd = Math.sqrt(jAllScores.reduce((a,v)=>a+Math.pow(v-(jAllScores.reduce((s,x)=>s+x,0)/jAllScores.length),2),0)/jAllScores.length);
    const pStd = Math.sqrt(pAllScores.reduce((a,v)=>a+Math.pow(v-(pAllScores.reduce((s,x)=>s+x,0)/pAllScores.length),2),0)/pAllScores.length);
    const uncertainty = ((jStd+pStd)/2) > 2 ? 'ë†’ìŒ' : ((jStd+pStd)/2) > 1 ? 'ë³´í†µ' : 'ë‚®ìŒ';

    fMeta.textContent=`${played}ì¼ ë°ì´í„° ê¸°ë°˜`;

    fGrid.innerHTML=`
      <div class="fc-card">
        <div class="fc-label">JíŒ€ ì¢…í•© ì˜ˆì¸¡ ìŠ¹ë¥ </div>
        <div class="fc-value j">${Math.round(jPred*100)}%</div>
        <div class="fc-sub">ì „ì²´ ${Math.round(jRate*100)}% Â· ìµœê·¼ ${Math.round(jRecentRate*100)}%<br>ì ìˆ˜ íŠ¸ë Œë“œ ${jScoreTrend>=0?'â–²':'â–¼'}${Math.abs(jScoreTrend).toFixed(2)}</div>
        <div class="fc-bar"><div class="fc-bar-fill j" style="width:${Math.round(jPred*100)}%"></div></div>
      </div>
      <div class="fc-card">
        <div class="fc-label">PíŒ€ ì¢…í•© ì˜ˆì¸¡ ìŠ¹ë¥ </div>
        <div class="fc-value p">${Math.round(pPred*100)}%</div>
        <div class="fc-sub">ì „ì²´ ${Math.round(pRate*100)}% Â· ìµœê·¼ ${Math.round(pRecentRate*100)}%<br>ì ìˆ˜ íŠ¸ë Œë“œ ${pScoreTrend>=0?'â–²':'â–¼'}${Math.abs(pScoreTrend).toFixed(2)}</div>
        <div class="fc-bar"><div class="fc-bar-fill p" style="width:${Math.round(pPred*100)}%"></div></div>
      </div>
      <div class="fc-card">
        <div class="fc-label">ì˜ˆìƒ ì¢…ë£Œì¼</div>
        <div class="fc-value gold">${predictedEndStr}</div>
        <div class="fc-sub">${predictedWinner}íŒ€ ë¨¼ì € 15ìŠ¹ ì˜ˆìƒ<br>ë‚¨ì€ ê²½ê¸° ${allFutureDates.length}ì¼</div>
      </div>
      <div class="fc-card">
        <div class="fc-label">ì˜ˆì¸¡ ë¶ˆí™•ì‹¤ì„±</div>
        <div class="fc-value ${uncertainty==='ë‚®ìŒ'?'win':'gold'}">${uncertainty}</div>
        <div class="fc-sub">ì ìˆ˜ ë³€ë™í­ ê¸°ì¤€<br>JÂ±${jStd.toFixed(1)} / PÂ±${pStd.toFixed(1)}</div>
      </div>
    `;

    const trendDesc = jScoreTrend > pScoreTrend
      ? `JíŒ€ì´ ìµœê·¼ ìƒìŠ¹ì„¸(+${jScoreTrend.toFixed(2)}) Â· PíŒ€ ëŒ€ë¹„ ì¢‹ì€ íë¦„`
      : pScoreTrend > jScoreTrend
      ? `PíŒ€ì´ ìµœê·¼ ìƒìŠ¹ì„¸(+${pScoreTrend.toFixed(2)}) Â· JíŒ€ ëŒ€ë¹„ ì¢‹ì€ íë¦„`
      : 'ì–‘íŒ€ íŠ¸ë Œë“œ ë¹„ìŠ·';
    fNote.innerHTML=`ğŸ“ˆ ${trendDesc} Â· ì˜ˆì¸¡ ì‹ ë¢°ë„ <b>${uncertainty==='ë‚®ìŒ'?'ì–‘í˜¸':'ë³´í†µ'}</b>`;
  })();

  // Weekly
  const wCont=document.getElementById('weeks-container'); wCont.innerHTML='';
  let totalJ=0,totalP=0;
  WEEK_SCHEDULE.forEach(wk=>{
    let wJ=0,wP=0;
    wk.dates.forEach(d=>{if(dayResults[d])dayResults[d].winner==='j'?wJ++:wP++;});
    totalJ+=wJ;totalP+=wP;
    const hasData=wk.dates.some(d=>dayResults[d]);
    const sum=hasData?(wJ>wP?`<span class="week-wins-summary wws-j">J ${wJ}ìŠ¹ Â· P ${wP}ìŠ¹</span>`:wP>wJ?`<span class="week-wins-summary wws-p">J ${wJ}ìŠ¹ Â· P ${wP}ìŠ¹</span>`:`<span class="week-wins-summary wws-tie">J ${wJ}ìŠ¹ Â· P ${wP}ìŠ¹</span>`):`<span class="week-wins-summary wws-tie">ì˜ˆì •</span>`;
    const block=document.createElement('div'); block.className='week-block';
    block.innerHTML=`<div class="week-label">${wk.label} &nbsp;(${shortD(wk.dates[0])}~${shortD(wk.dates[wk.dates.length-1])}) ${sum}</div>`;
    const dDiv=document.createElement('div'); dDiv.className='week-days';
    dDiv.style.gridTemplateColumns=`repeat(${wk.dates.length},1fr)`;
    wk.dates.forEach(d=>{
      const res=dayResults[d], isT=d===todayLabel, card=document.createElement('div');
      const isHoliday = d==='03ì›” 02ì¼';
      if(isHoliday){
        card.className='day-card holiday';
        card.innerHTML=`<div class="day-date">${shortD(d)}</div><div class="day-scores"><span style="color:var(--muted);font-size:16px;font-weight:300">â€”</span></div><div class="day-badge tbd">ëŒ€ì²´ê³µíœ´ì¼</div>`;
      } else if(res){
        const diff = fix2(Math.abs(res.j - res.p));
        const winColor = res.winner==='j' ? 'var(--j)' : 'var(--p)';
        const dIdx = _allDateHeaders.indexOf(d);

        // ìŠ¹íŒ€ MVP ê³„ì‚°
        const winTeamMems = res.winner==='j' ? jTeam : pTeam;
        let dayMvp = null, dayMvpScore = -1;
        if(dIdx >= 0){
          winTeamMems.forEach(m => {
            const s = m.scores[dIdx];
            if(s !== null && s > dayMvpScore){ dayMvpScore = s; dayMvp = m; }
          });
        }
        const mvpHtml = dayMvp ? `<div class="day-mvp"><span class="day-mvp-star">â­</span>${dayMvp.name} ${dayMvpScore}ì </div>` : '';

        card.className=`day-card ${res.winner}-win${isT?' today-card':''}`;
        card.innerHTML=`${isT?'<div class="today-line"></div>':''}
          <div class="day-date">${shortD(d)}${isT?' ğŸ”´':''}</div>
          <div class="day-scores"><span class="day-sc j">${res.j}</span><span class="day-sep">:</span><span class="day-sc p">${res.p}</span></div>
          <div class="day-badge ${res.winner}">${res.winner==='j'?'JíŒ€ ìŠ¹':'PíŒ€ ìŠ¹'}</div>
          ${mvpHtml}
          <div class="day-detail">
            <div class="dd-title">SCORE</div>
            <div class="dd-score-row"><span class="dd-team" style="color:var(--j)">J</span><span class="dd-val" style="color:var(--j)">${res.j}</span></div>
            <div class="dd-score-row"><span class="dd-team" style="color:var(--p)">P</span><span class="dd-val" style="color:var(--p)">${res.p}</span></div>
            <div class="dd-diff" style="color:${winColor}">+${diff} ì°¨</div>
            ${dayMvp?`<div style="margin-top:5px;font-size:9px;color:var(--gold)">â­ MVP ${dayMvp.name}</div>`:''}
          </div>`;
      } else {
        card.className='day-card upcoming';
        card.innerHTML=`<div class="day-date">${shortD(d)}</div><div class="day-scores"><span style="color:var(--muted);font-size:16px;font-weight:300">â€”</span></div><div class="day-badge tbd">ì˜ˆì •</div>`;
      }
      dDiv.appendChild(card);
    });
    block.appendChild(dDiv); wCont.appendChild(block);
  });
  document.getElementById('week-meta').textContent=`ì´ ${TOTAL_WD}í‰ì¼ Â· J ${totalJ}ìŠ¹ Â· P ${totalP}ìŠ¹`;

  // Stakes
  const jLeading=jWins>=pWins;
  const winTeam=jLeading?jTeam:pTeam, loseTeam=jLeading?pTeam:jTeam;
  const wL=jLeading?'j':'p', lL=jLeading?'p':'j';
  const exemptList=winTeam.filter(m=>!m.isIntern).sort((a,b)=>b.transfer-a.transfer).slice(0,2);
  const eduList=loseTeam.filter(m=>!m.isIntern).sort((a,b)=>a.transfer-b.transfer).slice(0,2);
  const exemptNames=new Set(exemptList.map(m=>m.name));
  const eduNames=new Set(eduList.map(m=>m.name));

  const buildStakes=(list,id,team)=>{
    const body=document.getElementById(id); body.innerHTML='';
    if(!list.length){body.innerHTML='<div class="s-note">ì´ê´€ë§¤ì¶œ ë°ì´í„°ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”</div>';return;}
    list.forEach((m,i)=>{
      const row=document.createElement('div'); row.className='s-row';
      row.innerHTML=`<div class="s-rank">${i+1}</div><div class="s-name-st">${m.name}</div><span class="s-team-chip ${team}">${team.toUpperCase()}íŒ€</span><div class="s-transfer">${m.transfer>0?m.transfer.toLocaleString('ko-KR')+'ì›':'ë°ì´í„° ì—†ìŒ'}</div>`;
      body.appendChild(row);
    });
    const note=document.createElement('div'); note.className='s-note';
    note.innerHTML=`â€» í˜„ì¬ ê¸°ì¤€ Â· ì¸í„´ ì œì™¸ Â· ìµœì¢… í™•ì •ì€ í”„ë¡œëª¨ì…˜ ì¢…ë£Œ í›„<br>â€» ìŠ¹ë¦¬íŒ€ ê¸°ì¤€: í˜„ì¬ ë¦¬ë”©íŒ€(${jLeading?'J':'P'}íŒ€)`;
    body.appendChild(note);
  };
  buildStakes(exemptList,'exempt-body',wL);
  buildStakes(eduList,'edu-body',lL);

  // â”€â”€ ê°œì¸ í…Œì´ë¸” í˜ì´ì§€ë„¤ì´ì…˜ ì¤€ë¹„ â”€â”€
  // playedDatesë¥¼ ìµœì‹ â†’ê³¼ê±° ìˆœìœ¼ë¡œ ë’¤ì§‘ê¸°
  const reversedHeaders = [...playedDates].reverse();
  _pagedHeaders = reversedHeaders;
  _pagedDates   = reversedHeaders.map(h => shortD(h));
  _pageIndex    = 0;
  _pagedData    = {
    jTeam, pTeam,
    jTeamAvg, pTeamAvg,
    exemptNames, eduNames
  };
  renderIndividualTable();

  // ì—…ë°ì´íŠ¸ ë±ƒì§€
  const now2=new Date();
  document.getElementById('update-time').textContent=`${String(now2.getHours()).padStart(2,'0')}:${String(now2.getMinutes()).padStart(2,'0')} ì—…ë°ì´íŠ¸`;
  const badge=document.getElementById('update-badge');
  badge.style.display='flex';
  document.getElementById('loading').style.display='none';
  document.getElementById('dashboard').style.display='block';
}

/* â•â•â•â•â•â• FETCH & INIT â•â•â•â•â•â• */
async function loadData(){
  try{
    const res=await fetch(CSV_URL+'&t='+Date.now());
    if(!res.ok)throw new Error(`HTTP ${res.status}`);
    const text=await res.text();
    const rows=parseCSV(text);
    const data=parseData(rows);
    if(!data.jTeam.length||!data.pTeam.length)throw new Error('íŒ€ ë°ì´í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì‹œíŠ¸ êµ¬ì¡°ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.');
    render(data);
  }catch(e){
    document.getElementById('loading').style.display='none';
    document.getElementById('error-msg').style.display='block';
    document.getElementById('error-detail').textContent=e.message;
  }
}

loadData();
setInterval(loadData, 5*60*1000);
</script>
</body>
</html>
